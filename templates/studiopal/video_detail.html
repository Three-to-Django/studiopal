{% extends 'base.html' %} {% block content %}

{% load comment_tags %}
{% include_bootstrap %}
{% include_static %}

<video width="530" height="440" controls>
  <source src="{{ video.video.url }}" type="video/mp4" />
  <source src="{{ video.video.url }}" type="video/x-flv" />
  <source src="{{ video.video.url }}" type="video/MP2T" />
  <source src="{{ video.video.url }}" type="video/3gpp" />
  <source src="{{ video.video.url }}" type="video/3gpp2" />
  <source src="{{ video.video.url }}" type="video/3gpp-tt" />
  <source src="{{ video.video.url }}" type="video/quicktime" />
  <source src="{{ video.video.url }}" type="video/x-msvideo" />
  <source src="{{ video.video.url }}" type="video/x-ms-wmv" />
  <source src="{{ video.video.url }}" type="video/webm" />
  <source src="{{ video.video.url }}" type="video/ogg" />
  <source src="{{ video.video.url }}" type="video/H264" />
  <source src="{{ video.video.url }}" type="video/H264-RCDO" />
  <source src="{{ video.video.url }}" type="video/H264-SVC" />
</video>


<div id="comments-container" class="pt4 ml5 mb4">
    {% for comment in video.comments.all %}
        <div class="comment" style="padding: 10px;">
            <p class="comment-text">{{ comment.text }}</p>
            <p class="comment-author">
                by <span class="font-weight-bold">{{comment.author}}</span>
            </p>
        </div>
    {% endfor %}
</div>

<div class="comment-form">
    {% csrf_token %}
    <textarea id="comment-form"></textarea>
    <button id="comment-button">Add Your Comment</button>
</div>
<script>
    const commentButton = document.querySelector("#comment-button")

    commentButton.addEventListener("click", function(){
        console.log("button clicked")
        const csrfToken = document.querySelector("input[name='csrfmiddlewaretoken']").value
        const commentInput = document.getElementById("comment-form").value
        let videoId = 1
        fetch(`/studiopal/add_comment/${videoId}/`, {
            method: 'POST',
            body: JSON.stringify({"text": commentInput }),
            headers: {
                'Content-type': 'application/json; charset=UTF-8',
                'X-CSRFToken': csrfToken
            }
        })
        .then(res => res.json())
        .then(data => {
                console.log("Response returned")
                console.log(data)
                const commentsContainer = document.querySelector("#comments-container")
                const newDiv = document.createElement("div")
                newDiv.className="comment"
                newDiv.style="padding: 10px;"
                newDiv.innerHTML = data.html
                commentsContainer.appendChild(newDiv)
                commentInput=''
            })
    })

</script>


{% endblock content %}


